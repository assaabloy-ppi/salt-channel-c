language: C
addons:
    apt:
      packages:
       - valgrind
cache:
    apt: true
    directories: $HOME/libsodium
install:
  - sh travis-install-libsodium.sh
  - export LD_LIBRARY_PATH=$HOME/libsodium/lib
compiler:
 - gcc
script:
 - mkdir -p build_tweetnacl
 - cd build_tweetnacl
 - cmake -DSANITIZE_ADDRESS=On -DSANITIZE_UNDEFINED=On -DCMAKE_BUILD_TYPE=Debug ..
 - make
 - make test
 - cd ..
 - mkdir -p build_sodium
 - cd build_sodium
 - cmake -DSANITIZE_ADDRESS=On -DSANITIZE_UNDEFINED=On -DCMAKE_BUILD_TYPE=Debug -DUSE_SODIUM=1 ..
 - make
 - make test
 - cd ..
 - sh valgrind.sh
 - cd build_tweetnacl
 - gcov src/CMakeFiles/salt.dir/salt.c.gcno src/CMakeFiles/salt.dir/salti_handshake.c.gcno src/CMakeFiles/salt.dir/salti_util.c.gcno


after_success:
 - bash <(curl -s https://codecov.io/bash)
